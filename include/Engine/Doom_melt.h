#ifndef doom_melt_h
#define doom_melt_h

#include <Arduino.h>
#include <DisplayConfig.h>
#include <SdCard_utils.h>

const uint8_t epd_bitmap_doom []  = {
	0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x80, 0xaa, 0xaa, 0x2a, 0xa0, 0xaa, 0xaa, 0x80, 0xaa, 0xaa, 0xa2, 0xaa, 0x0a, 0xa8, 0xaa, 0x00, 
	0x00, 0xff, 0xff, 0x1f, 0xf0, 0xff, 0xff, 0xc1, 0xff, 0xff, 0xc7, 0xff, 0x07, 0xfc, 0xff, 0x00, 
	0x88, 0xaa, 0xaa, 0xaa, 0xa8, 0xaa, 0xaa, 0xea, 0xaa, 0xaa, 0xae, 0xaa, 0x8a, 0xaa, 0xaa, 0x88, 
	0x00, 0xd4, 0xdd, 0xdd, 0xdc, 0xdd, 0x5d, 0x77, 0x5d, 0x5d, 0x1d, 0x5d, 0x1d, 0xdc, 0x1d, 0x00, 
	0x00, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xa2, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0x2a, 0x00, 
	0x00, 0x54, 0x55, 0x57, 0x54, 0x57, 0x55, 0x55, 0x55, 0x75, 0x15, 0xd5, 0x35, 0x75, 0x15, 0x00, 
	0x88, 0xaa, 0xaa, 0xaa, 0xa8, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0x88, 
	0x00, 0xdc, 0x5d, 0xf5, 0xdc, 0xdd, 0x75, 0x45, 0xd7, 0xdd, 0x1d, 0x5f, 0x1d, 0x5d, 0x1d, 0x00, 
	0x00, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xa2, 0xaa, 0xaa, 0x2a, 0xaa, 0xaa, 0xaa, 0x2a, 0x00, 
	0x00, 0xf4, 0x01, 0x7f, 0x54, 0x05, 0xf7, 0xf7, 0x7f, 0x50, 0x15, 0xff, 0x5f, 0xd7, 0x15, 0x00, 
	0x88, 0xaa, 0x8a, 0xee, 0xa8, 0x8a, 0xae, 0xea, 0xaa, 0xa8, 0xaa, 0xee, 0xaa, 0xae, 0xaa, 0x88, 
	0x00, 0xfc, 0x81, 0xdf, 0xfc, 0x07, 0xfe, 0xe7, 0x7f, 0xf0, 0x1d, 0xff, 0xdf, 0xff, 0x1f, 0x00, 
	0x00, 0xba, 0x82, 0xbe, 0xba, 0x0b, 0xba, 0xa3, 0x3b, 0xa8, 0x2b, 0xfa, 0xbb, 0xbb, 0x2a, 0x00, 
	0x00, 0xfc, 0x03, 0xff, 0xfc, 0x05, 0xff, 0xf7, 0x7f, 0xd0, 0x1f, 0xfd, 0xff, 0x7f, 0x1f, 0x00, 
	0x88, 0xea, 0x8a, 0xee, 0xe8, 0x8a, 0xee, 0xea, 0xae, 0xe8, 0xae, 0xee, 0xaa, 0xae, 0xaa, 0x88, 
	0x00, 0xfc, 0x81, 0xff, 0xfc, 0x05, 0xff, 0xf7, 0x7f, 0xd0, 0x1f, 0xff, 0xdf, 0xdf, 0x1d, 0x00, 
	0x00, 0xba, 0x83, 0xbe, 0xba, 0x0a, 0xba, 0xa3, 0x3b, 0xa8, 0xab, 0xaa, 0xba, 0xab, 0x2b, 0x00, 
	0x00, 0xfc, 0x83, 0xff, 0xfd, 0x07, 0xff, 0xf7, 0x7f, 0xf0, 0x1f, 0xdf, 0xff, 0xff, 0x3f, 0x00, 
	0x88, 0xee, 0x8a, 0xae, 0xee, 0x8a, 0xee, 0xea, 0xae, 0xe8, 0xae, 0xea, 0xae, 0xae, 0xae, 0x88, 
	0x00, 0xfc, 0x81, 0xdf, 0xd4, 0x07, 0xdf, 0xf7, 0x7d, 0xf0, 0x15, 0xf5, 0xff, 0xff, 0x3f, 0x00, 
	0x00, 0xba, 0x83, 0xab, 0xaa, 0x0b, 0xaa, 0xa3, 0x3a, 0xb8, 0xaa, 0xaa, 0xbb, 0xbb, 0x3b, 0x00, 
	0x00, 0xfc, 0x83, 0xd7, 0x55, 0x07, 0xdf, 0xf7, 0x7d, 0x70, 0x15, 0xd5, 0xff, 0xff, 0x3f, 0x00, 
	0x88, 0xee, 0x8a, 0xaa, 0xae, 0x8e, 0xae, 0xea, 0xae, 0xa8, 0xaa, 0xaa, 0xee, 0xee, 0xae, 0x88, 
	0x00, 0xfc, 0x83, 0xdd, 0x5c, 0x05, 0xdf, 0xf7, 0x7d, 0x50, 0x1d, 0xdd, 0xfc, 0xcf, 0x3f, 0x00, 
	0x00, 0xba, 0x83, 0xaa, 0xaa, 0x0a, 0xba, 0xa3, 0x2b, 0xa8, 0xaa, 0xaa, 0xaa, 0xeb, 0x3b, 0x00, 
	0x00, 0xfc, 0x83, 0xf7, 0x75, 0x07, 0xff, 0xf7, 0x7f, 0x70, 0x17, 0xf7, 0xd4, 0xcf, 0x3f, 0x00, 
	0x88, 0xee, 0x8a, 0xaa, 0xae, 0x8e, 0xee, 0xea, 0xae, 0xa8, 0xaa, 0xaa, 0xae, 0xee, 0xaa, 0x88, 
	0x00, 0xfc, 0x83, 0xdd, 0xdc, 0x05, 0xff, 0xf7, 0x7f, 0xd0, 0x1d, 0xdd, 0x5c, 0xcf, 0x3f, 0x00, 
	0x00, 0xba, 0x83, 0xaa, 0xaa, 0x0a, 0xba, 0xa3, 0x2b, 0xa8, 0xaa, 0xaa, 0xae, 0xee, 0x3b, 0x00, 
	0x00, 0xfc, 0x83, 0xfd, 0x7d, 0x05, 0xf7, 0xf7, 0x77, 0x50, 0x17, 0xf7, 0x7c, 0xc7, 0x3f, 0x00, 
	0x88, 0xee, 0x8a, 0xaa, 0xae, 0x8e, 0xea, 0xea, 0xae, 0xa8, 0xaa, 0xaa, 0xa8, 0xee, 0xae, 0x88, 
	0x00, 0xfc, 0x83, 0xdd, 0xdc, 0x05, 0xfd, 0xf7, 0x5f, 0xd0, 0x1d, 0xdd, 0xfc, 0xc7, 0x3d, 0x00, 
	0x00, 0xba, 0x82, 0xaa, 0xaa, 0x0e, 0xab, 0xa3, 0x2b, 0xb8, 0xba, 0xab, 0xb8, 0xee, 0x3a, 0x00, 
	0x00, 0x7c, 0x83, 0xf7, 0x5d, 0x07, 0xf7, 0xf7, 0x77, 0x70, 0x1d, 0xd7, 0xf8, 0x47, 0x37, 0x00, 
	0x88, 0xae, 0xea, 0xea, 0xae, 0x8e, 0xea, 0xee, 0xea, 0xa8, 0xae, 0xaa, 0xa8, 0xea, 0xaa, 0x88, 
	0x00, 0xdc, 0xf3, 0xff, 0xfc, 0x1d, 0xdf, 0xf7, 0x7d, 0xdc, 0x1f, 0xdf, 0xf0, 0xc3, 0x3d, 0x00, 
	0x00, 0xaa, 0xba, 0xba, 0xae, 0x3a, 0xaa, 0xa2, 0x2a, 0xae, 0xba, 0xaf, 0xb8, 0xa3, 0x2a, 0x00, 
	0x00, 0x74, 0xff, 0xff, 0xfd, 0xff, 0x7f, 0x77, 0xff, 0xff, 0x1f, 0xff, 0xf0, 0x43, 0x3f, 0x00, 
	0x88, 0xae, 0xee, 0xee, 0xee, 0xea, 0xaa, 0xae, 0xea, 0xee, 0xbe, 0xef, 0xe8, 0xea, 0xae, 0x88, 
	0x00, 0xdc, 0xff, 0xff, 0xfc, 0xff, 0xff, 0xe7, 0xff, 0xff, 0x1f, 0xff, 0xe0, 0xc1, 0x3f, 0x00, 
	0x00, 0xaa, 0xba, 0x3b, 0xb8, 0xbf, 0xae, 0xa2, 0xbb, 0xba, 0x0e, 0xbe, 0xa0, 0xe0, 0x2a, 0x00, 
	0x00, 0xfc, 0xff, 0x3f, 0xf0, 0xff, 0xff, 0x80, 0xff, 0xff, 0x07, 0xfc, 0xe0, 0xc1, 0x3f, 0x00, 
	0x88, 0xae, 0xea, 0x8e, 0xe8, 0xee, 0xee, 0x88, 0xee, 0xee, 0x8a, 0xe8, 0xe8, 0xe8, 0xaa, 0x88, 
	0x00, 0xfc, 0xff, 0x0f, 0xc0, 0xff, 0x3f, 0x00, 0xfe, 0xff, 0x01, 0xe0, 0xc0, 0xc0, 0x3f, 0x00, 
	0x00, 0xae, 0xba, 0x03, 0x80, 0xeb, 0x0f, 0x00, 0xb8, 0xfb, 0x00, 0xa0, 0x80, 0xe0, 0x2b, 0x00, 
	0x00, 0xfc, 0xff, 0x01, 0x00, 0xfe, 0x0f, 0x00, 0xf0, 0x3f, 0x00, 0x80, 0x00, 0xc0, 0x3f, 0x00, 
	0x88, 0xee, 0xee, 0x88, 0x88, 0xec, 0x8a, 0x88, 0xe8, 0xae, 0x88, 0x88, 0x88, 0xe8, 0xae, 0x88, 
	0x00, 0xdc, 0x7f, 0x00, 0x00, 0xf8, 0x01, 0x00, 0xc0, 0x0f, 0x00, 0x00, 0x00, 0xc0, 0x3f, 0x00, 
	0x00, 0xae, 0x3a, 0x00, 0x00, 0xe8, 0x02, 0x00, 0x80, 0x0b, 0x00, 0x00, 0x00, 0xe0, 0x3b, 0x00, 
	0x00, 0xfc, 0x1f, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xc0, 0x3f, 0x00, 
	0x88, 0xee, 0x8e, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0xe8, 0xae, 0x88, 
	0x00, 0xfc, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x3f, 0x00, 
	0x00, 0xae, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0x3b, 0x00, 
	0x00, 0xfc, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x3f, 0x00, 
	0x88, 0xee, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0xae, 0x88, 
	0x00, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x00, 
	0x00, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3a, 0x00, 
	0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 
	0x88, 0x8e, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0xa8, 0x88, 
	0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 
	0x80, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
const uint8_t epd_bitmap_test_image []  = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


#define WIDTH 128
#define HEIGHT 64
#define BYTES_PER_COL (HEIGHT / 8)  // 8
void split_xbm_into_columns(const uint8_t *xbm, uint8_t *columns, int width, int height) {
    for (int x = 0; x < width; x++) {
        for (int y_byte = 0; y_byte < height / 8; y_byte++) {
            uint8_t value = 0;
            for (int bit = 0; bit < 8; bit++) {
                int y = y_byte * 8 + bit;
                if (y >= height) break;

                int byte_index = (y * ((width + 7) / 8)) + (x / 8);
                uint8_t byte = xbm[byte_index];

                if (byte & (1 << (x % 8))) {
                    value |= (1 << bit);
                }
            }
            columns[x * (height / 8) + y_byte] = value;
        }
    }
}

void draw_byte_pixels(uint8_t byte, int x, int y) {
    for (int bit = 0; bit < 8; bit++) {
        if (byte & (1 << bit)) {
            u8g2.drawPixel(x, y + bit);
        }
    }
}
void draw_column(int x, uint8_t* column) {
    for (int byte = 0; byte < 8; byte++) {
        draw_byte_pixels(column[byte], x, byte * 8);
    }
}
void draw_columns(uint8_t* columns) {
	for (int x = 0; x < 128; x++) {
		//draw_column(x, columns + x * 8);
        draw_column(x, columns + x * BYTES_PER_COL);
	}

}
void copy_column(uint8_t* dest, const uint8_t* src, int x) {
    for (int byte = 0; byte < BYTES_PER_COL; byte++) 
        dest[x * BYTES_PER_COL + byte] = src[x * BYTES_PER_COL + byte];
    
}
void copy_columns(uint8_t* dest,uint8_t* src){
    for(byte x = 0; x < 128; x++) copy_column(dest, src, x);
}
uint8_t melt_delay[128];

uint8_t melt_order[128];

void generate_doom_style_delays() {
    const uint8_t max_delay = 15;
    const uint8_t group_size = 4;  // по 4 колонки в групі
    for (int x = 0; x < 128; x += group_size) {
        uint8_t delay = random(0, max_delay + 1);  // для всієї групи
        for (int i = 0; i < group_size && x + i < 128; i++) {
            melt_delay[x + i] = delay;
        }
    }

    // Легке перемішування сусідніх груп, щоби не було занадто рівно
    for (int i = 0; i < 10; i++) {
        int a = random(0, 127);
        int b = random(0, 127);
        uint8_t t = melt_delay[a];
        melt_delay[a] = melt_delay[b];
        melt_delay[b] = t;
    }
}


// makes meltig effect for 1 column of image
// 1 column 8 bytes 64 bit
bool melt_column_bit(uint8_t* melt_column, uint8_t* new_column, uint8_t local_melt_step) {
    if (local_melt_step >= 64) return true;  // захист від виходу за межі

    uint8_t pixel_index = 63 - local_melt_step;  // pixel number in column
    uint8_t new_bit = (new_column[pixel_index / 8] >> (pixel_index % 8)) & 0x01;

    // Shifting all bytes of melt_column down by 1 bit + adding new bit
    for (int8_t byte = 7; byte >= 0; --byte) {
        uint8_t next_bit = (byte > 0) ? ((melt_column[byte - 1] & 0x80) >> 7) : new_bit;
        melt_column[byte] = (melt_column[byte] << 1) | next_bit;
    }
    // Перевірка чи колонка зсунулась до кінця і дорівнює new_column
    for (uint8_t n = 0; n < BYTES_PER_COL; ++n) {
        if (melt_column[n] != new_column[n]) 
            return false;
    }
    return true;
}

bool melt_columns(uint8_t* melt_columns, uint8_t* new_columns, uint8_t step) {
    bool all_melt_finished = true;
    for (byte x = 0; x < 128; x++) {






		
        if (step >= melt_delay[x]) {
            uint8_t local_step = step - melt_delay[x];
            uint8_t* calculeted_melt_column = melt_columns + x * BYTES_PER_COL;
            uint8_t* calculated_new_column = new_columns + x * BYTES_PER_COL;

            bool column_melt_finished = melt_column_bit(calculeted_melt_column,calculated_new_column,local_step);
            if (!column_melt_finished) all_melt_finished = false;
        }
        else 
            all_melt_finished = false;  
    }
    return all_melt_finished;
}
void print_columns(uint8_t* columns) {
    for (int x = 0; x < 128; x++) {
        Serial.print("Column ");
        Serial.print(x);
        Serial.print(": ");
        for (int byte = 0; byte < 8; byte++) {
            if (columns[x * 8 + byte] < 16) Serial.print("0");
            Serial.print(columns[x * 8 + byte], HEX);
            Serial.print(" ");
        }
        Serial.println();
    }
}

void doom_melt(const uint8_t* old_image, const uint8_t* new_image) {
    uint8_t* old_image_columns = (uint8_t*)malloc(128 * 8);
    uint8_t* new_image_columns = (uint8_t*)malloc(128 * 8);
    uint8_t* melt_columns_buf = (uint8_t*)malloc(128 * 8);

    if (!old_image_columns || !new_image_columns || !melt_columns_buf) {
        return;
    }
    split_xbm_into_columns(epd_bitmap_test_image, new_image_columns, 128, 64);
    split_xbm_into_columns(old_image, old_image_columns, 128, 64);
    copy_columns(melt_columns_buf, old_image_columns);
//sdsdsdsdasdasdsad
    byte step = 0;
   bool finished = false;
   generate_doom_style_delays();
    while (!finished) {
        ESP.wdtDisable();
        finished = melt_columns(melt_columns_buf, new_image_columns, step);
        u8g2.clearBuffer();
        draw_columns(melt_columns_buf);
        u8g2.sendBuffer();
        delay(30);
        ESP.wdtEnable(WDTO_8S);
        Serial.printf("step =%d",step);
        step++;
    }
    free(old_image_columns);
    free(new_image_columns);
    free(melt_columns_buf);
}


#endif